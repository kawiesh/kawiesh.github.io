<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="theme-color" content="black"/>
<meta name="msapplication-TileColor" content="#da532c"/>
<meta name="msapplication-navbutton-color" content="black"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>List GitHub Files</title>

<style>				
*{
box-sizing: border-box;
margin:0; padding:0; 
outline: none;
}	

body{
background: rgb(251,244,234) url("");
min-width: 100vw; 
max-width: 100vw; 
min-height: 100vh;
position: relative;
display: flex;
flex-direction: column;
justify-content: flex-start;
align-items: center;
}

#container{
height: auto;
border: 0px solid red;
margin-top: 20px;
position: relative;
display: flex;
flex-direction: column;
justify-content: flex-start;
align-items: center;
}

table{
position: relative;
border:0px solid black;		
border-collapse: separate;
border-spacing: 5px;
max-width: 100%;
table-layout: fixed;
align-self: flex-start;
}
 
td{
border: 0px solid black;
vertical-align: bottom;
overflow: auto;
text-transform: lowercase;
font: small-caps 15px Arial;
padding: 2px 0;
width: 15ch;
text-align: left;
}


tr>td:nth-child(2){
padding: 0;
text-align: left;
}


input:not([type]){
width: 25ch;
height: 2em;
color: blue;
padding: 2px;
border: 1px solid black;
}


.radio input{
height: 10px;
}



.list{
width: 100%;
height: 350px;
margin-top: -1px;
border: 1px solid black;
}

button{
border: 1px solid black;
padding: 2px;
}

#go{
align-self: flex-start;
}

#copy{
margin-top: -1px;
align-self: flex-start;
}




@media (orientation:portrait){
#container{width: 95%;}
body{background-size: 35%;}		
}	

@media (orientation:landscape){
#container{width: 75%;}
body{background-size: 50%;}			
}	

</style>
</head>
<body data-nosnippet>
<div id="container">


<table>
<tbody>
<tr>
<td>Owner</td>
<td><input class="owner" required></td>
</tr>
<tr>
<td>Repo name</td>
<td><input class="repo" required></td>
</tr>
<tr>
<td>File extension </td>
<td><input class="filetype" required></td>
</tr>
<tr>
<tr class="radio">
<td>URL Path</td>
<td>
<span>rel
<input type="radio" name="x" checked>
</span>
<span>abs
<input type="radio" name="x">
</span>
</td>
</tbody>
</table>
<br>

<button id="go">GO!</button>

<div class="message"></div>

<textarea class="list" readonly></textarea>

<button id="copy">Copy</button>

<div class="links"></div>


</div>
<script>				
let create= (x)=> document.createElement(x),
select= (x,y=document)=> y.querySelector(x),
selectAll= (x,y=document)=> y.querySelectorAll(x);

let owner= select(".owner");
let repo= select(".repo");
let filetype= select(".filetype");

let links= select(".links");
let list= select(".list");
let message= select(".message");
let copy= select("#copy");
let go= select("#go");
let radio= selectAll(".radio input");

owner.placeholder= "repo owner";
repo.placeholder= "repo name";
filetype.placeholder= "leave empty to list all files";


//CREATE TABLE



async function fetchFiles(){
let talinks= [], divlinks= [];
message.innerHTML= "Loading...";

let path= repo.value.split(/\/(.+)/)[0];
let folder= repo.value.split(/\/(.+)/)[1]||"";
let url= `https://api.github.com/repos/${owner.value}/${path}/contents/${folder}?v=` + Date.now();

let request= await fetch(url);
let reply= await request.json();
let files= reply.map(i=>{
let url= i.path, text= i.path.split(".")[0];
//let href= (radio[0].checked) ? url : "x.com/"+ url;
let href= i["html_url"];
if(href.endsWith(filetype.value||"") && i.type=="file"){
talinks.push(href);
divlinks.push(`<a class="link" href="${href}">${text}</a>`);
}
});


list.value= talinks.join("\n");
links.innerHTML= divlinks.join("<br>");
message.innerHTML= "List of files";
}

//DO THE MAIN FUNCTION

go.onclick= fetchFiles;


copy.onclick= function(){
copyData(list.value,this);
};

//COPY FUNCTION
function copyData(a,b){
try{
navigator.clipboard.writeText(a);
b.innerHTML= "Copied";
}
catch(x){
let temp= create("input");
temp.style.cssText="opacity:0; pointer-events:none";
document.body.append(temp);
temp.value= a;
temp.focus(); temp.select();
document.execCommand("copy");
b.innerHTML= "Copied";
temp.remove();
}
}





</script>	
</body>
</html>
